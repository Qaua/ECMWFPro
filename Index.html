<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<meta name="theme-color" content="#000000">
<title>ULGI PRO MAX | V29</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@100;300;400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-deep: #000000;
    --glass: rgba(28, 28, 30, 0.75);
    --glass-border: rgba(255, 255, 255, 0.12);
    --text-main: #ffffff;
    --text-dim: rgba(235, 235, 245, 0.6);
    
    /* Traffic Light Colors */
    --safe: #32d74b;   /* Green */
    --warn: #ffd60a;   /* Yellow */
    --danger: #ff453a; /* Red */
    --cold: #0a84ff;   /* Blue */

    --blur: blur(25px);
  }

  body { margin: 0; font-family: 'SF Pro Display', sans-serif; background: var(--bg-deep); color: var(--text-main); min-height: 100vh; padding-bottom: 40px; overflow-x: hidden; }
  
  /* Dynamic Sky */
  #sky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: linear-gradient(180deg, #1c1c1e 0%, #000000 100%); transition: background 2s ease; }

  .app-wrap { max-width: 480px; margin: 0 auto; padding: 20px; animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }

  /* Hero */
  .hero { text-align: center; margin: 20px 0 30px; position: relative; }
  .temp-main { font-size: 96px; font-weight: 100; letter-spacing: -4px; line-height: 1; }
  .cond-pill { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 20px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); font-weight: 600; margin-top: 10px; transition: 0.5s; }
  
  /* Sun Arc Widget */
  .sun-card { position: relative; height: 140px; margin-bottom: 20px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; }
  .sun-arc-wrap { position: relative; width: 260px; height: 130px; overflow: hidden; }
  .sun-arc-line { position: absolute; bottom: 0; left: 0; width: 260px; height: 260px; border: 2px dashed rgba(255,255,255,0.3); border-radius: 50%; box-sizing: border-box; }
  .sun-icon { position: absolute; bottom: 0; left: 0; width: 260px; height: 260px; border-radius: 50%; transform: rotate(-90deg); transition: transform 1.5s ease-out; }
  .sun-orb { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); width: 24px; height: 24px; background: #ffd60a; border-radius: 50%; box-shadow: 0 0 20px #ffd60a; }
  .sun-times { display: flex; justify-content: space-between; width: 100%; padding: 0 20px; font-size: 13px; color: var(--text-dim); margin-top: -20px; position: relative; z-index: 2; }

  /* Glass Box */
  .box { background: var(--glass); backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur); border: 1px solid var(--glass-border); border-radius: 22px; padding: 18px; margin-bottom: 12px; }
  .box-head { font-size: 13px; color: var(--text-dim); font-weight: 600; text-transform: uppercase; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

  /* Grid Stats */
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px; }
  .stat-item { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 16px; text-align: center; }
  .stat-lbl { font-size: 11px; color: var(--text-dim); margin-bottom: 4px; }
  .stat-val { font-size: 18px; font-weight: 600; }

  /* 24h Scroll */
  .scroll-x { display: flex; overflow-x: auto; gap: 12px; padding-bottom: 5px; scroll-behavior: smooth; }
  .scroll-x::-webkit-scrollbar { display: none; }
  .h-card { min-width: 70px; display: flex; flex-direction: column; align-items: center; gap: 6px; padding: 12px 5px; border-radius: 16px; background: rgba(255,255,255,0.03); border: 1px solid transparent; }
  .h-time { font-size: 13px; opacity: 0.7; }
  .h-wind-txt { font-size: 10px; font-weight: 700; text-transform: uppercase; text-align: center; line-height: 1.2; height: 24px; display: flex; align-items: center; }

  /* 7 Day */
  .d-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
  .d-row:last-child { border-bottom: none; }
  .d-wind-col { text-align: right; width: 100px; display: flex; flex-direction: column; align-items: flex-end; }
  
  /* Animations */
  @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes pulseRed { 0% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(255, 69, 58, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0); } }
  .pulse-danger { animation: pulseRed 2s infinite; border: 1px solid var(--danger) !important; }
  .pulse-warn { border: 1px solid var(--warn) !important; }
</style>
</head>
<body>

<div id="sky"></div>

<div class="app-wrap">
  
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div onclick="document.getElementById('locSelect').click()" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
      <i class="fas fa-location-arrow"></i>
      <span id="locName" style="font-weight:700; font-size:18px;">–õ–æ–∫–∞—Ü–∏—è...</span>
      <select id="locSelect" style="position:absolute; width:150px; opacity:0;"></select>
    </div>
    <div style="font-size:11px; opacity:0.5;">ECMWF Pro</div>
  </div>

  <div class="hero">
    <div class="temp-main" id="curTemp">--¬∞</div>
    <div style="font-size:16px; opacity:0.8; margin-top:-10px;">
      –°–µ–∑—ñ–ª–µ—Ç—ñ–Ω—ñ: <span id="feelsLike">--</span>¬∞
    </div>
    
    <div id="statusPill" class="cond-pill" style="color:var(--safe); border:1px solid var(--safe);">
      <i class="fas fa-circle-check"></i> <span>–î–µ—Ä–µ–∫—Ç–µ—Ä –∂–∏–Ω–∞–ª—É–¥–∞...</span>
    </div>
  </div>

  <div class="sun-card">
    <div class="sun-arc-wrap">
      <div class="sun-arc-line"></div>
      <div class="sun-icon" id="sunRotator">
        <div class="sun-orb"></div>
      </div>
    </div>
    <div class="sun-times">
      <span id="sunriseTime">--:--</span>
      <span style="opacity:0.5; font-size:10px;">–ö“Æ–ù –î–û“í–ê–°–´</span>
      <span id="sunsetTime">--:--</span>
    </div>
  </div>

  <div class="grid-3">
    <div class="stat-item">
      <div class="stat-lbl"><i class="fas fa-wind"></i> –ñ–ï–õ</div>
      <div class="stat-val" id="windMain">--</div>
      <div style="font-size:10px; opacity:0.6;" id="windDirMain">--</div>
    </div>
    <div class="stat-item">
      <div class="stat-lbl"><i class="fas fa-droplet"></i> –´–õ“í–ê–õ</div>
      <div class="stat-val" id="humMain">--%</div>
    </div>
    <div class="stat-item">
      <div class="stat-lbl"><i class="fas fa-snowflake"></i> “ö–ê–†</div>
      <div class="stat-val" id="snowMain">0 —Å–º</div>
    </div>
    <div class="stat-item">
      <div class="stat-lbl"><i class="fas fa-sun"></i> UV –ò–ù–î–ï–ö–°</div>
      <div class="stat-val" id="uvMain">--</div>
    </div>
    <div class="stat-item">
      <div class="stat-lbl"><i class="fas fa-lungs"></i> AQI (–ê–£–ê)</div>
      <div class="stat-val" id="aqiMain">--</div>
    </div>
    <div class="stat-item">
      <div class="stat-lbl"><i class="fas fa-umbrella"></i> –ñ–ê–£–´–ù</div>
      <div class="stat-val" id="rainMain">0 –º–º</div>
    </div>
  </div>

  <div class="box">
    <div class="box-head"><i class="far fa-clock"></i> 24 –°–∞“ì–∞—Ç (–ñ–µ–ª –ë–∞“ì—ã—Ç—ã –ê–Ω—ã“õ)</div>
    <div class="scroll-x" id="hourlyScroll"></div>
  </div>

  <div class="box">
    <div class="box-head"><i class="far fa-calendar-alt"></i> 7 –ö“Ø–Ω–¥—ñ–∫ –ë–æ–ª–∂–∞–º</div>
    <div id="dailyList"></div>
  </div>

</div>

<script>
// --- LOCATIONS (Bayan-Olgii Sums) ---
const LOCATIONS = [
  { name: "”®–ª–≥–∏–π (–û—Ä—Ç–∞–ª—ã“õ)", lat: 48.9707, lon: 89.9678 },
  { name: "–ê–ª—Ç–∞–π", lat: 48.2970, lon: 89.5130 },
  { name: "–ë–∞—è–Ω–Ω—É—É—Ä", lat: 48.9950, lon: 91.0020 },
  { name: "–ë—É–≥–∞—Ç", lat: 49.0650, lon: 90.1980 },
  { name: "–ë—É–ª–≥–∞–Ω", lat: 46.9150, lon: 91.0950 },
  { name: "–î—ç–ª“Ø“Ø–Ω", lat: 47.8540, lon: 90.7320 },
  { name: "–ù–æ–≥–æ–æ–Ω–Ω—É—É—Ä", lat: 49.6280, lon: 90.2100 },
  { name: "–°–∞–≥—Å–∞–π", lat: 48.9103, lon: 89.6052 },
  { name: "–¢–æ–ª–±–æ", lat: 48.4333, lon: 90.2333 },
  { name: "–£–ª–∞–∞–Ω—Ö—É—Å", lat: 49.0494, lon: 89.4080 },
  { name: "–¶—ç–Ω–≥—ç–ª", lat: 48.9392, lon: 89.1436 }
];

let curLoc = LOCATIONS[0];

// --- INIT ---
document.addEventListener('DOMContentLoaded', () => {
  // Dropdown Setup
  const sel = document.getElementById('locSelect');
  LOCATIONS.forEach((l, i) => {
    let opt = document.createElement('option');
    opt.value = i; opt.text = l.name;
    sel.add(opt);
  });
  sel.addEventListener('change', (e) => {
    curLoc = LOCATIONS[e.target.value];
    document.getElementById('locName').innerText = curLoc.name;
    fetchData();
  });
  document.getElementById('locName').innerText = curLoc.name;
  
  fetchData();
});

// --- API & DATA ENGINE ---
async function fetchData() {
  const wUrl = `https://api.open-meteo.com/v1/forecast?latitude=${curLoc.lat}&longitude=${curLoc.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,weather_code,wind_speed_10m,wind_direction_10m,snow_depth&hourly=temperature_2m,weather_code,wind_speed_10m,wind_direction_10m,uv_index&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,wind_speed_10m_max,wind_direction_10m_dominant&timezone=auto`;
  const aUrl = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${curLoc.lat}&longitude=${curLoc.lon}&current=us_aqi`;

  try {
    const [wRes, aRes] = await Promise.all([fetch(wUrl), fetch(aUrl)]);
    const wData = await wRes.json();
    const aData = await aRes.json();
    renderApp(wData, aData);
  } catch(e) {
    console.error(e);
  }
}

// --- LOGIC HELPERS ---
function getWindText(deg) {
  const dirs = ["–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫", "–°–æ–ª—Ç-–®—ã“ì—ã—Å", "–®—ã“ì—ã—Å", "–û“£—Ç-–®—ã“ì—ã—Å", "–û“£—Ç“Ø—Å—Ç—ñ–∫", "–û“£—Ç-–ë–∞—Ç—ã—Å", "–ë–∞—Ç—ã—Å", "–°–æ–ª—Ç-–ë–∞—Ç—ã—Å"];
  return dirs[Math.round(deg / 45) % 8];
}

function getWindShort(deg) {
  const dirs = ["–°–û–õ–¢", "–°-–®–´“í", "–®–´“í–´–°", "–û-–®–´“í", "–û“¢–¢", "–û-–ë–ê–¢", "–ë–ê–¢–´–°", "–°-–ë–ê–¢"];
  return dirs[Math.round(deg / 45) % 8];
}

function getSafeLevel(temp, wind) {
  // Logic: 
  // RED: Wind > 10 OR Temp < -30
  // YELLOW: Wind > 4.5 OR Temp < -20
  // GREEN: Else
  if(wind >= 10 || temp <= -30) return { color: 'var(--danger)', icon: 'fa-triangle-exclamation', txt: '“ö–ê–£–Ü–ü–¢–Ü!', pulse: true };
  if(wind >= 4.5 || temp <= -20) return { color: 'var(--warn)', icon: 'fa-circle-exclamation', txt: '–°–ê“ö–¢–´“ö!', pulse: false };
  return { color: 'var(--safe)', icon: 'fa-shield-halved', txt: '“ö–ê–£–Ü–ü–°–Ü–ó', pulse: false };
}

// --- RENDER UI ---
function renderApp(d, a) {
  const c = d.current;
  const h = d.hourly;
  const days = d.daily;
  
  const windMs = c.wind_speed_10m / 3.6;
  const safe = getSafeLevel(c.temperature_2m, windMs);

  // 1. HERO
  document.getElementById('curTemp').innerText = Math.round(c.temperature_2m) + "¬∞";
  document.getElementById('feelsLike').innerText = Math.round(c.apparent_temperature);
  
  const pill = document.getElementById('statusPill');
  pill.style.color = safe.color;
  pill.style.borderColor = safe.color;
  pill.style.background = safe.pulse ? 'rgba(255, 69, 58, 0.2)' : 'rgba(255,255,255,0.1)';
  pill.className = safe.pulse ? 'cond-pill pulse-danger' : (safe.color === 'var(--warn)' ? 'cond-pill pulse-warn' : 'cond-pill');
  pill.innerHTML = `<i class="fas ${safe.icon}"></i> ${safe.txt} (–ñ–µ–ª: ${windMs.toFixed(1)} –º/—Å)`;

  // Atmosphere Color
  const sky = document.getElementById('sky');
  if(safe.color === 'var(--danger)') sky.style.background = "linear-gradient(180deg, #420000 0%, #000000 100%)";
  else if(safe.color === 'var(--warn)') sky.style.background = "linear-gradient(180deg, #332b00 0%, #000000 100%)";
  else sky.style.background = "linear-gradient(180deg, #1c1c1e 0%, #000000 100%)";

  // 2. SUN ARC CALCULATION
  const rise = new Date(days.sunrise[0]);
  const set = new Date(days.sunset[0]);
  const now = new Date();
  
  document.getElementById('sunriseTime').innerText = rise.toLocaleTimeString('kk-KZ', {hour:'2-digit', minute:'2-digit'});
  document.getElementById('sunsetTime').innerText = set.toLocaleTimeString('kk-KZ', {hour:'2-digit', minute:'2-digit'});
  
  // Angle: -90deg (start) to 90deg (end). Total 180deg span.
  let pct = 0;
  if (now > rise && now < set) {
    pct = (now - rise) / (set - rise);
  } else if (now >= set) {
    pct = 1;
  }
  const deg = -90 + (pct * 180);
  document.getElementById('sunRotator').style.transform = `rotate(${deg}deg)`;

  // 3. GRID STATS
  document.getElementById('windMain').innerText = windMs.toFixed(1) + " –º/—Å";
  document.getElementById('windDirMain').innerText = getWindText(c.wind_direction_10m);
  document.getElementById('humMain').innerText = c.relative_humidity_2m + "%";
  document.getElementById('snowMain').innerText = (c.snow_depth || 0) + " —Å–º";
  document.getElementById('uvMain').innerText = h.uv_index[new Date().getHours()]?.toFixed(1) || "-";
  document.getElementById('rainMain').innerText = c.precipitation + " –º–º";
  
  const aqi = a.current ? a.current.us_aqi : 0;
  const aqiEl = document.getElementById('aqiMain');
  aqiEl.innerText = aqi;
  aqiEl.style.color = aqi > 100 ? 'var(--danger)' : (aqi > 50 ? 'var(--warn)' : 'var(--safe)');

  // 4. 24H SCROLL (Clear Text Direction)
  let hHTML = "";
  const nowH = new Date().getHours();
  const startIdx = h.time.findIndex(t => parseInt(t.slice(11,13)) === nowH);
  
  for(let i=startIdx; i<startIdx+24; i++) {
    if(!h.time[i]) break;
    const t = h.time[i].slice(11,16);
    const temp = Math.round(h.temperature_2m[i]);
    const wSpd = h.wind_speed_10m[i] / 3.6;
    const wDir = getWindShort(h.wind_direction_10m[i]);
    const isDang = getSafeLevel(temp, wSpd).color !== 'var(--safe)';
    
    hHTML += `
      <div class="h-card" style="${isDang ? 'border:1px solid var(--warn); background:rgba(255,214,10,0.1)' : ''}">
        <span class="h-time">${i===startIdx?'“ö–∞–∑—ñ—Ä':t}</span>
        <span style="font-size:20px; margin:4px 0;">${getIcon(h.weather_code[i])}</span>
        <span style="font-weight:600; font-size:16px;">${temp}¬∞</span>
        <div style="width:100%; height:1px; background:rgba(255,255,255,0.1); margin:4px 0;"></div>
        <div style="font-size:12px; font-weight:700;">${wSpd.toFixed(1)}</div>
        <div class="h-wind-txt">${wDir}</div>
      </div>
    `;
  }
  document.getElementById('hourlyScroll').innerHTML = hHTML;

  // 5. 7 DAY LIST
  let dHTML = "";
  for(let i=0; i<7; i++) {
    const dayName = i===0 ? "–ë“Ø–≥—ñ–Ω" : new Date(days.time[i]).toLocaleDateString('kk-KZ', {weekday:'short'});
    const max = Math.round(days.temperature_2m_max[i]);
    const min = Math.round(days.temperature_2m_min[i]);
    const wMax = days.wind_speed_10m_max[i] / 3.6;
    const wDir = getWindShort(days.wind_direction_10m_dominant[i]);
    const safeCheck = getSafeLevel(min, wMax);
    
    dHTML += `
      <div class="d-row">
        <div style="width:60px; font-weight:600; font-size:16px;">${dayName}</div>
        <div style="font-size:22px; width:30px; text-align:center;">${getIcon(days.weather_code[i])}</div>
        <div style="display:flex; flex-direction:column; text-align:center; width:80px;">
           <span style="color:#fff; font-weight:600;">${max}¬∞</span>
           <span style="color:var(--text-dim); font-size:13px;">${min}¬∞</span>
        </div>
        <div class="d-wind-col">
           <span style="color:${safeCheck.color}; font-weight:700; font-size:15px;">${wMax.toFixed(1)} –º/—Å</span>
           <span style="font-size:11px; color:var(--text-dim); text-transform:uppercase;">${wDir}</span>
        </div>
      </div>
    `;
  }
  document.getElementById('dailyList').innerHTML = dHTML;
}

function getIcon(c) {
  if(c===0) return "‚òÄÔ∏è";
  if(c<3) return "‚õÖ";
  if(c===3) return "‚òÅÔ∏è";
  if(c<50) return "üå´";
  if(c<60) return "üåß";
  if(c<80) return "‚ùÑÔ∏è";
  return "‚õà";
}
</script>
</body>
</html>
